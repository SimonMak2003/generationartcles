<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Федералист | Генератор v2</title>
    <style>
        body { font-family: 'Lora', serif; background: #eceff1; padding: 20px; color: #222; }
        .wrapper { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-weight: bold; font-size: 13px; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .content-block { border: 1px solid #eee; background: #fafafa; padding: 15px; margin-bottom: 15px; border-radius: 6px; }
        .btn-add { background: #4caf50; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .btn-gen { background: #006aa7; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 15px; }
        #output { width: 100%; min-height: 300px; margin-top: 15px; font-family: monospace; font-size: 12px; }
        .delete-btn { background: #ff5252; color: white; border: none; padding: 5px; cursor: pointer; float: right; border-radius: 4px; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2>Генератор «Федералист»</h2>
    
    <div class="input-group"><label>Инфо (Дата | Категория)</label><input id="art_info" placeholder="6 июня | Политика"></div>
    <div class="input-group"><label>Заголовок</label><input id="art_title"></div>
    <div class="input-group"><label>Логлайн</label><input id="art_logline"></div>
    <div class="input-group"><label>Ссылка на главную панораму</label><input id="art_img"></div>

    <div id="content-area"></div>
    
    <div style="margin-top:10px;">
        <button class="btn-add" onclick="addBox('text')">+ Текст</button>
        <button class="btn-add" onclick="addBox('sub')">+ Подзаголовок</button>
        <button class="btn-add" onclick="addBox('quote')">+ Цитата</button>
        <button class="btn-add" onclick="addBox('pan')">+ Доп. панорама (100px)</button>
    </div>

    <hr style="margin:20px 0;">
    <div class="input-group"><label>Автор (BB-код)</label><input id="art_author" placeholder="[USER=1]Имя[/USER]"></div>
    <div class="input-group"><label>Фото автора (URL)</label><input id="art_author_img"></div>

    <button class="btn-gen" onclick="generate()">Сгенерировать код</button>
    <textarea id="output" readonly placeholder="Здесь появится готовый код..."></textarea>
</div>

<script>
const area = document.getElementById('content-area');

function addBox(type) {
    const div = document.createElement('div');
    div.className = 'content-block';
    div.dataset.type = type;
    let fields = '';
    
    if(type === 'text') fields = '<label>Текст (BB-коды работают):</label><textarea class="val" style="height:100px;"></textarea>';
    if(type === 'sub') fields = '<label>Подзаголовок:</label><input class="val">';
    if(type === 'quote') fields = '<label>Текст цитаты:</label><textarea class="val"></textarea><label>Автор цитаты:</label><input class="attr">';
    if(type === 'pan') fields = '<label>URL панорамы (в тексте):</label><input class="val">';

    div.innerHTML = `<button class="delete-btn" onclick="this.parentElement.remove()">Удалить</button>${fields}`;
    area.appendChild(div);
}

// Добавим одно поле текста по умолчанию
addBox('text');

function generate() {
    // Начало с инвертированного тега
    let out = "[/PARSEHTML]";
    
    // Блок шапки (оборачиваем в PARSEHTML ... /PARSEHTML наоборот)
    out += "[PARSEHTML]";
    const info = document.getElementById('art_info').value;
    const title = document.getElementById('art_title').value;
    const logline = document.getElementById('art_logline').value;
    const img = document.getElementById('art_img').value;

    if(info) out += `<div class="ArticleMeta">${info}</div>`;
    out += `<div class="ArticleHeader">${title}</div>`;
    if(logline) out += `<div class="ArticleLogline">${logline}</div>`;
    if(img) out += `<div style="text-align:center;padding:20px 0;"><img src="${img}" style="width:100%;object-fit:cover;max-height:200px;"></div>`;
    out += "[/PARSEHTML]"; 

    // Контентные блоки
    const blocks = document.querySelectorAll('.content-block');
    blocks.forEach(block => {
        const type = block.dataset.type;
        const val = block.querySelector('.val').value;

        if(type === 'text') {
            // Обычный текст идет без тегов HTML, чтобы работали BB-коды форума
            out += `\n${val}\n`;
        } else if(type === 'sub') {
            out += `[PARSEHTML]<div class="ArticleSubheader">${val}</div>[/PARSEHTML]`;
        } else if(type === 'quote') {
            const attr = block.querySelector('.attr').value;
            out += `[PARSEHTML]<div class="quote-container"><div class="quote-text">${val}</div><div class="quote-attribution">${attr}</div></div>[/PARSEHTML]`;
        } else if(type === 'pan') {
            out += `[PARSEHTML]<img src="${val}" class="ArticleInnerPanorama">[/PARSEHTML]`;
        }
    });

    // Футер
    const aName = document.getElementById('art_author').value;
    const aImg = document.getElementById('art_author_img').value;
    
    out += `[PARSEHTML]<div class="AuthorColumn" style="background-color:#f5f5f5;--color:#006aa7">
<div class="AuthorInfo"><div class="AuthorProfile">
    <img class="AuthorPfp" src="${aImg}">
    <p class="AuthorName">${aName}</p>
</div><p class="AuthorDesc">Автор статьи</p></div></div>
<div class="ArticleNote">Вы можете поддержать издание «Федералист», поставив реакцию к статье или отправив донат.</div>[/PARSEHTML]`;

    // Завершаем основным тегом, чтобы не ломать верстку форума
    out += "[PARSEHTML]";

    document.getElementById('output').value = out;
}
</script>
</body>
</html>
