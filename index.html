<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>Федералист | Генератор кода</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Serif:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lora', Georgia, serif; background: #eceff1; padding: 20px; color: #222; }
        .wrapper { max-width: 960px; margin: 0 auto; background: white; padding: 28px; border-radius: 8px; box-shadow: 0 2px 14px rgba(0, 0, 0, 0.08); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 18px; cursor: pointer; border: none; background: #ddd; border-radius: 5px; font-weight: 600; }
        .tab-btn.active { background: #006aa7; color: white; }
        .input-group { margin-bottom: 14px; }
        label { display: block; font-weight: 700; margin-bottom: 6px; font-size: 13px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        textarea { min-height: 80px; }
        .btn-add { background: #4caf50; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; margin-right: 8px; margin-bottom: 5px; }
        .btn-primary { background: #006aa7; color: white; padding: 10px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; width: 100%; }
        #output { width: 100%; min-height: 300px; margin-top: 12px; background: #f9f9f9; font-family: monospace; font-size: 13px; padding: 10px; box-sizing: border-box; }
        .delete-btn { background: #ff5252; color: white; border: none; padding: 6px 10px; cursor: pointer; border-radius: 6px; margin-top: 5px; }
        .content-block { border: 1px dashed #ccc; padding: 15px; margin-bottom: 15px; border-radius: 8px; background: #fdfdfd; }
        .controls { margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
    </style>
</head>

<body>
    <div class="wrapper">
        <h2>Генератор контента «Федералист»</h2>

        <div class="tabs">
            <button class="tab-btn active" id="tab-article">Статья</button>
            <button class="tab-btn" id="tab-interview">Интервью</button>
        </div>

        <div id="article-fields">
            <div class="input-group"><label>Инфо (Дата | Категория)</label><input id="art_info" placeholder="6 июня | Политика"></div>
            <div class="input-group"><label>Название</label><input id="art_title" placeholder="Заголовок статьи"></div>
            <div class="input-group"><label>Логлайн</label><input id="art_logline" placeholder="Короткий логлайн"></div>
            <div class="input-group"><label>Первый абзац (Вводный текст)</label><textarea id="art_first"></textarea></div>

            <div class="input-group">
                <label>Конструктор контента статьи</label>
                <div id="article-content"></div>
                <div class="controls">
                    <button class="btn-add" onclick="addBlock('text')">+ Текст</button>
                    <button class="btn-add" onclick="addBlock('quote')">+ Цитата</button>
                    <button class="btn-add" onclick="addBlock('subheader')">+ Подзаголовок</button>
                    <button class="btn-add" onclick="addBlock('panorama')">+ Панорама (100px)</button>
                </div>
            </div>

            <div class="input-group"><label>Главная картинка (URL)</label><input id="art_img" placeholder="https://..."></div>
            <div class="input-group"><label>Автор (BB-код)</label><input id="art_author" placeholder="[USER=8]Имя[/USER]"></div>
            <div class="input-group"><label>Фото автора (URL)</label><input id="art_author_img" placeholder="https://..."></div>
        </div>

        <div id="interview-fields" style="display:none;">
            <div class="input-group"><label>Заголовок интервью</label><input id="int_title"></div>
            <div id="dialog-container"></div>
            <button class="btn-add" onclick="addDialog('question')">+ Вопрос</button>
            <button class="btn-add" onclick="addDialog('answer')">+ Ответ</button>
        </div>

        <div style="display:flex; gap:8px; margin-top:20px;">
            <button class="btn-primary" id="generate-btn">Сгенерировать код</button>
            <button class="btn-primary" id="copy-btn" style="width:160px; background:#2d9cdb;">Копировать</button>
        </div>
        <textarea id="output" readonly></textarea>
    </div>

<script>
// Переключение вкладок
const tabArticle = document.getElementById('tab-article');
const tabInterview = document.getElementById('tab-interview');
const articleFields = document.getElementById('article-fields');
const interviewFields = document.getElementById('interview-fields');

tabArticle.onclick = () => { tabArticle.classList.add('active'); tabInterview.classList.remove('active'); articleFields.style.display = 'block'; interviewFields.style.display = 'none'; };
tabInterview.onclick = () => { tabInterview.classList.add('active'); tabArticle.classList.remove('active'); articleFields.style.display = 'none'; interviewFields.style.display = 'block'; };

const articleContent = document.getElementById('article-content');

function addBlock(type) {
    const wrapper = document.createElement('div');
    wrapper.className = 'content-block';
    wrapper.dataset.type = type;
    
    let inner = '';
    if(type === 'text') inner = '<label>Текст (BB-коды разрешены):</label><textarea class="blk-val"></textarea>';
    if(type === 'quote') inner = '<label>Цитата:</label><textarea class="blk-val"></textarea><input type="text" class="blk-attr" placeholder="Атрибуция">';
    if(type === 'subheader') inner = '<label>Подзаголовок:</label><input type="text" class="blk-val">';
    if(type === 'panorama') inner = '<label>Ссылка на внутреннюю панораму:</label><input type="text" class="blk-val">';

    wrapper.innerHTML = inner + '<button class="delete-btn" onclick="this.closest(\'.content-block\').remove()">Удалить блок</button>';
    articleContent.appendChild(wrapper);
}

// Добавляем один блок текста по умолчанию
addBlock('text');

function generate() {
    let out = "[PARSEHTML]";
    const note = `<div class="ArticleNote">Вы можете поддержать издание «Федералист», поставив реакцию к статье, присоединившись к её обсуждению или отправив донат игровой валюты (или золота) автору статьи.</div>`;

    if (articleFields.style.display !== 'none') {
        const info = document.getElementById('art_info').value.trim();
        const title = document.getElementById('art_title').value.trim();
        const logline = document.getElementById('art_logline').value.trim();
        const first = document.getElementById('art_first').value.trim();
        const img = document.getElementById('art_img').value.trim();
        const author = document.getElementById('art_author').value.trim();
        const authorImg = document.getElementById('art_author_img').value.trim();

        if (info) out += `<div class="ArticleMeta">${info}</div>\n`;
        out += `<div class="ArticleHeader">${title}</div>\n`;
        if (logline) out += `<div class="ArticleLogline">${logline}</div>\n`;
        
        if (first) {
            out += `<div class="ArticleText">[/PARSEHTML]\n${first}\n[PARSEHTML]</div>\n`;
        }
        
        if (img) {
            out += `<div style="text-align: center; padding: 20px 0;"><img src="${img}" style="width: 100%; object-fit: cover; max-height: 200px; box-shadow: 0 3px 6px rgba(0,0,0,0.16);"></div>\n`;
        }

        const blocks = articleContent.querySelectorAll('.content-block');
        blocks.forEach(block => {
            const type = block.dataset.type;
            const val = block.querySelector('.blk-val').value.trim();

            if (!val && type !== 'panorama') return;

            if (type === 'text') {
                out += `<div class="ArticleText">[/PARSEHTML]\n${val}\n[PARSEHTML]</div>\n`;
            } 
            else if (type === 'subheader') {
                out += `<div class="ArticleSubheader">${val}</div>\n`;
            }
            else if (type === 'panorama') {
                out += `<img src="${val}" class="ArticleInnerPanorama">\n`;
            }
            else if (type === 'quote') {
                const attr = block.querySelector('.blk-attr').value.trim();
                // Логика: Текст цитаты в BB-режиме, Атрибуция в BB-режиме
                out += `<div class="quote-container"><div class="quote-text">[/PARSEHTML]${val}[PARSEHTML]</div><div class="quote-attribution">[/PARSEHTML]${attr}[PARSEHTML]</div></div>\n`;
            }
        });

        // Блок автора: Имя автора теперь тоже позволяет использовать BB-коды (например, [USER])
        out += `<div class="AuthorColumn" style="background-color: #f5f5f5; --color: #006aa7; margin-top: 20px;">
<div class="AuthorInfo"><div class="AuthorProfile"><img class="AuthorPfp" src="${authorImg}"><p class="AuthorName">[/PARSEHTML]${author}[PARSEHTML]</p></div><p class="AuthorDesc">Автор статьи</p></div></div>\n`;

    } else {
        out += `<div class="ArticleHeader">ИНТЕРВЬЮ</div>\n`;
    }

    out += note + "[/PARSEHTML]";
    document.getElementById('output').value = out;
}

document.getElementById('generate-btn').onclick = generate;
document.getElementById('copy-btn').onclick = () => {
    const out = document.getElementById('output');
    out.select();
    document.execCommand('copy');
    alert('Код скопирован!');
};
</script>
</body>
</html>
